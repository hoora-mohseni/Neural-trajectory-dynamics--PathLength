%====================================================================================
%% pathLengh and error correlation- Day 1
%====================================================================================

figure('color', 'w', 'Position', [300, 300, 1000, 400]);

myColor = viridis(137);
allclr = [];
colorIdx = 1;
r_path = [];
r_err = [];

for i = 2:4
    allPath = mean(pathLengthSliding.(epochs{i}));
    err     = nanmean(error.(epochs{i}));

    if i == 2 
        sign = 'o' ;
    elseif i == 3 
        sign = "square";
    else
        sign = '^';
    end

    for j = 1:numel(err)
       clr = myColor(colorIdx, :);
        allclr = [allclr; clr];
        a(i) = plot(err(j), allPath(j), sign, 'MarkerFaceColor', clr, 'MarkerEdgeColor', clr); hold on
        colorIdx = colorIdx + 1;
    end
    r_err =  [r_err, err];
    r_path = [r_path, allPath];
end

% Remove NaNs before correlation
validIdx = ~isnan(r_err) & ~isnan(r_path);
[R, P] = corrcoef(r_err(validIdx), r_path(validIdx));
R_value = R(1,2);
P_value = P(1,2);

% Display R and p in command window
fprintf('R value: %.3f\n', R_value);
fprintf('p value: %.3f\n', P_value);
text(0.05, 0.9, sprintf('R = %.2f\np = %.3f', R_value, P_value), ...
    'Units', 'normalized', 'FontSize', 16, 'FontWeight', 'bold');

mdl = fitlm(r_err, r_path);
plot(r_err, mdl.Fitted, 'color', myColor(20, :), 'LineWidth', 2);

yticks(70:10:120)
xticks(0:15:45)
xlim([0, 45]); ylim([70, 120])
box off; 
colormap(allclr);
c = colorbar;
c.Ticks = [];       
set(gca, "FontSize", 20, 'LineWidth', .8, 'TickDir', 'out');
axis square;
lgd = legend([a(2), a(3), a(4)], {'Baseline', 'Learning', 'Washout'});
lgd.FontSize = 12;

%====================================================================================
%% pathLengh and error correlation- both Days
%====================================================================================

figure('color', 'w', 'Position', [300, 300, 1000, 400]);

r_path = [];
r_err = [];

for i = [2:4, 6:8]
    allPath = mean(pathLengthSliding.(epochs{i}));
    err     = nanmean(error.(epochs{i}));

    allPath(err>35) = [];
    err(err>35) = [];
    
    if i == 2 || i ==6
        sign = 'o' ;
    elseif i == 3 || i == 7
        sign = "square";
    else
        sign = '^';
    end

    if i == 2 || i == 3 || i == 4
        for j = 1:numel(err)
    
            a(i) = plot(err(j), allPath(j), sign, 'MarkerFaceColor', [0.3, 0.05, 0.4], 'MarkerEdgeColor', [0.3, 0.05, 0.4]); hold on
            colorIdx = colorIdx + 1;
        end
    end
    if i == 6 || i == 7 || i == 8
        for j = 1:numel(err)
    
            a(i) = plot(err(j), allPath(j), sign, 'MarkerFaceColor', [0.1 , 0.6  , 0.4], 'MarkerEdgeColor', [0.1 , 0.6  , 0.4]); hold on
            colorIdx = colorIdx + 1;
        end
    end

    r_err =  [r_err, err];
    r_path = [r_path, allPath];
end

% Remove NaNs before correlation
validIdx = ~isnan(r_err) & ~isnan(r_path);
[R, P] = corrcoef(r_err(validIdx), r_path(validIdx));
R_value = R(1,2);
P_value = P(1,2);

% Display R and p in command window
fprintf('R value: %.3f\n', R_value);
fprintf('p value: %.3f\n', P_value);
text(0.05, 0.9, sprintf('R = %.2f\np = %.3f', R_value, P_value ), ...
    'Units', 'normalized', 'FontSize', 16, 'FontWeight', 'bold');

mdl = fitlm(r_err, r_path);
plot(r_err, mdl.Fitted, 'color', 'k', 'LineWidth', 2);

yticks(70:10:120)
xticks(0:15:45)
xlim([0, 45]); ylim([70, 120])
box off; 
set(gca, "FontSize", 20, 'LineWidth', .8, 'TickDir', 'out')
axis square
lgd = legend([a(2), a(3), a(4)], {'Baseline', 'Learning', 'Washout'});
lgd.FontSize = 12;

%====================================================================================
%% pathLengh and reaction time correlation- Day 1
%====================================================================================

figure('color', 'w', 'Position', [300, 300, 1000, 400]);

myColor = viridis(137);
allclr = [];
colorIdx = 1;
r_path = [];
r_reactT = [];

for i = 2:4 
    allPath = mean(pathLengthSliding.(epochs{i}));
    reactT     = mean(RT.(epochs{i}));

    if i == 2 
        sign = 'o' ;
    elseif i == 3 
        sign = "square";
    else
        sign = '^';
    end

    for j = 1:numel(reactT)
       clr = myColor(colorIdx, :);
        allclr = [allclr; clr];
        a(i) = plot(reactT(j), allPath(j), sign, 'MarkerFaceColor', clr, 'MarkerEdgeColor', clr); hold on
        colorIdx = colorIdx + 1;
    end
    r_reactT =  [r_reactT, reactT];
    r_path = [r_path, allPath];
end

% Remove NaNs before correlation
validIdx = ~isnan(r_reactT) & ~isnan(r_path);
[R, P] = corrcoef(r_reactT(validIdx), r_path(validIdx));
R_value = R(1,2);
P_value = P(1,2);

% Display R and p in command window
fprintf('R value: %.3f\n', R_value);
fprintf('p value: %.3f\n', P_value);
text(0.05, 0.9, sprintf('R = %.2f\np = %.3f', R_value, P_value), ...
    'Units', 'normalized', 'FontSize', 16, 'FontWeight', 'bold');

mdl = fitlm(r_reactT, r_path);
plot(r_reactT, mdl.Fitted, 'color', myColor(20, :), 'LineWidth', 2);

box off; 
colormap(allclr);
c = colorbar;
c.Ticks = [];        % Removes both ticks and labels
set(gca, "FontSize", 20, 'LineWidth', .8, 'TickDir', 'out')
axis square
lgd = legend([a(2), a(3), a(4)], {'Baseline', 'Learning', 'Washout'});
lgd.FontSize = 12;

%====================================================================================
%% Error and reaction time correlation- Day 1
%====================================================================================

figure('color', 'w', 'Position', [300, 300, 1000, 400]);

myColor = viridis(137);
allclr = [];
colorIdx = 1;
r_err = [];
r_reactT = [];

for i = [2:4]
    err = mean(error.(epochs{i}));
    reactT     = mean(RT.(epochs{i}));

    if i == 2 
        sign = 'o' ;
    elseif i == 3  
        sign = "square";
    else
        sign = '^';
    end

    for j = 1:numel(reactT)
        clr = myColor(colorIdx, :);
        allclr = [allclr; clr];
        a(i) = plot(reactT(j), err(j), sign, 'MarkerFaceColor', clr, 'MarkerEdgeColor', clr); hold on
        colorIdx = colorIdx + 1;
    end

    r_reactT =  [r_reactT, reactT];
    r_err = [r_err, err];
end

% Remove NaNs before correlation
validIdx = ~isnan(r_reactT) & ~isnan(r_err);
[R, P] = corrcoef(r_reactT(validIdx), r_err(validIdx));
R_value = R(1,2);
P_value = P(1,2);

% Display R and p in command window
fprintf('R value: %.3f\n', R_value);
fprintf('p value: %.3f\n', P_value);
text(0.05, 0.9, sprintf('R = %.2f\np = %.3f', R_value, P_value), ...
    'Units', 'normalized', 'FontSize', 16, 'FontWeight', 'bold');

mdl = fitlm(r_reactT, r_err);
plot(r_reactT, mdl.Fitted, 'color', myColor(20, :), 'LineWidth', 2);

box off; 
colormap(allclr);
c = colorbar;
c.Ticks = [];        % Removes both ticks and labels
set(gca, "FontSize", 20, 'LineWidth', .8, 'TickDir', 'out');
axis square;
lgd = legend([a(2), a(3), a(4)], {'Baseline', 'Learning', 'Washout'});
lgd.FontSize = 12;

%====================================================================================
%% displacement and error correlation- both Days
%====================================================================================

figure('color', 'w', 'Position', [300, 300, 1000, 400]);


r_distance = [];
r_err = [];

for i = [2:4, 6:8]
    alldistance = mean(distance.(epochs{i}));
    err     = mean(error.(epochs{i}));

    alldistance(err>35) = [];
    err(err>35) = [];
    
    if i == 2 || i ==6
        sign = 'o' ;
    elseif i == 3 || i == 7
        sign = "square";
    else
        sign = '^';
    end

    if i == 2 || i == 3 || i == 4
        for j = 1:numel(err)
    
            a(i) = plot(err(j), alldistance(j), sign, 'MarkerFaceColor', [0.3, 0.05, 0.4], 'MarkerEdgeColor', [0.3, 0.05, 0.4]); hold on
            colorIdx = colorIdx + 1;
        end
    end
    if i == 6 || i == 7 || i == 8
        for j = 1:numel(err)
    
            a(i) = plot(err(j), alldistance(j), sign, 'MarkerFaceColor', [0.1 , 0.6  , 0.4], 'MarkerEdgeColor', [0.1 , 0.6  , 0.4]); hold on
            colorIdx = colorIdx + 1;
        end
    end

    r_err =  [r_err, err];
    r_distance = [r_distance, alldistance];
end

% Remove NaNs before correlation
validIdx = ~isnan(r_err) & ~isnan(r_distance);
[R, P] = corrcoef(r_err(validIdx), r_distance(validIdx));
R_value = R(1,2);
P_value = P(1,2);

% Display R and p in command window
fprintf('R value: %.3f\n', R_value);
fprintf('p value: %.3f\n', P_value);

% Annotate R and p on the plot
text(0.05, 0.9, sprintf('R = %.2f\np = %.3f', R_value, P_value), ...
    'Units', 'normalized', 'FontSize', 16, 'FontWeight', 'bold');


 mdl = fitlm(r_err, r_distance);
 plot(r_err, mdl.Fitted, 'color', 'k', 'LineWidth', 2);

%yticks(70:10:120)
%xticks(0:15:45)
%xlim([0, 45]); ylim([70, 120])
box off; 
%c.Ticks = [];        % Removes both ticks and labels
set(gca, "FontSize", 20, 'LineWidth', .8, 'TickDir', 'out')
axis square
lgd = legend([a(2), a(3), a(4)], {'Baseline', 'Learning', 'Washout'});
lgd.FontSize = 12;

%====================================================================================
%% net displacement and reaction time correlation- Day 1
%====================================================================================

figure('color', 'w', 'Position', [300, 300, 1000, 400]);

myColor = viridis(137);
allclr = [];
colorIdx = 1;
r_distance = [];
r_reactT = [];

for i = 2:4 
    alldistance = mean(distance.(epochs{i}));
    reactT     = mean(RT.(epochs{i}));

    if i == 2 
        sign = 'o' ;
    elseif i == 3 
        sign = "square";
    else
        sign = '^';
    end

    for j = 1:numel(reactT)
       clr = myColor(colorIdx, :);
        allclr = [allclr; clr];
        a(i) = plot(reactT(j), alldistance(j), sign, 'MarkerFaceColor', clr, 'MarkerEdgeColor', clr); hold on
        colorIdx = colorIdx + 1;
    end
    r_reactT =  [r_reactT, reactT];
    r_distance = [r_distance, alldistance];
end

% Remove NaNs before correlation
validIdx = ~isnan(r_reactT) & ~isnan(r_distance);
[R, P] = corrcoef(r_reactT(validIdx), r_distance(validIdx));
R_value = R(1,2);
P_value = P(1,2);

% Display R and p in command window
fprintf('R value: %.3f\n', R_value);
fprintf('p value: %.3f\n', P_value);

% Annotate R and p on the plot
text(0.05, 0.9, sprintf('R = %.2f\np = %.3f', R_value, P_value), ...
    'Units', 'normalized', 'FontSize', 16, 'FontWeight', 'bold');



mdl = fitlm(r_reactT, r_distance);
plot(r_reactT, mdl.Fitted, 'color', myColor(20, :), 'LineWidth', 2);

%yticks(70:10:120)
%xticks(0:15:45)
%xlim([0, 45]); %ylim([70, 120])
box off; 
colormap(allclr);
c = colorbar;
c.Ticks = [];        % Removes both ticks and labels
set(gca, "FontSize", 20, 'LineWidth', .8, 'TickDir', 'out')
axis square
%legend([a(2), a(3), a(4)], {' ', ' ', ' '});
