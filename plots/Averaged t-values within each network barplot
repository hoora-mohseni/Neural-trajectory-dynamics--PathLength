%====================================================================================
%% Averagted t-values within each network barplot
%====================================================================================

% Extracting Major Network indices
Ntwrk = {'vis', 'sommot', 'dorsattn', 'salventattn', 'limbic', 'cont', 'default'}; 
for i = 1:numel(Ntwrk)
    NtwrkIdx{i} = find(cellfun(@(x) count(lower(x), lower(Ntwrk{i})), headers) == 1);
end

NtwrkContrast = struct();
for n = 1:numel(Ntwrk)
    targetLoadings = corrmatrix_tvalues_6Con(NtwrkIdx{n}, :);
    NtwrkContrast.(Ntwrk{n}) = mean(targetLoadings, 1);
end

%%
% Define the network names (for X-axis labels)
Ntwrk = {'vis', 'sommot', 'dorsattn', 'salventattn', 'limbic', 'cont', 'default'}; 
NumNetworks = numel(Ntwrk);

% --- 1. Consolidate Data into a Matrix (7 Networks x 6 Conditions) ---
% Rows will be Networks, Columns will be the 6 Conditions
PlotData = zeros(NumNetworks, 3);

for n = 1:NumNetworks
    % Extract the 1x6 vector for the current network and place it in the matrix
    % NOTE: This assumes NtwrkContrast has been correctly built in the previous step
    PlotData(n, :) = NtwrkContrast.(Ntwrk{n})(:,[1,3,5]); % day 1
    %PlotData(n, :) = NtwrkContrast.(Ntwrk{n})(:,[2,4,6]);  % day 2
end

% --- 2. Create the Grouped Bar Plot ---
figure('color', 'w', 'Position', [300, 300, 1400, 800]);
% The bar function plots each row (network) along the x-axis, with 
% grouped bars for each column (condition).
h = bar(PlotData); 
hold on;

% --- 3. Apply Specific Colors Manually ---
% h is an array of 6 graphic objects (one for each condition/group).
% We set the color based on the condition index:


h(1).FaceColor = [0.3, 0.05, 0.4]; % Day 1 
h(2).FaceColor = [0.3, 0.05, 0.4];
h(3).FaceColor = [0.3, 0.05, 0.4];

% Day 2 
% h(1).FaceColor = [0.1 , 0.6  , 0.4]; % Day 2 
% h(2).FaceColor = [0.1 , 0.6  , 0.4];
% h(3).FaceColor = [0.1 , 0.6  , 0.4];

% --- 4. Add Labels and Formatting ---
% Set the X-axis labels to the network names
set(gca, 'XTick', 1:NumNetworks, 'XTickLabel', Ntwrk, 'FontSize', 15);
title('Averaged T-values per Network and Condition');
ylabel('Mean T-value'); %ylim([-2.5, 2.5])
xlabel('Network');

% Assume conditions are paired across A, B, C phases of your learning model
LegendLabels = {'E-Baseline vs. L-Rest Day 2', 'E-Learning vs. L-Baseline Day 2',  ...
                'L-Learning vs. E-Learning Day 2'};

% Add a legend using the bar objects (h) and custom labels
legend(h, LegendLabels, 'Location', 'northeast');
grid off;
